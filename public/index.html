<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="style.css" />

    <title>Document</title>
  </head>

  <body>
    <div class="navbar">
      <div class="dropdown" id="setMenu">
        <button class="dropbtn">
          <i class="fa fa-cog fa-lg"></i>
        </button>
        <div class="dropdown-content">
          <a href="/auth">Log In</a>
          <a onclick = "showColorPicker(0)">
            Background Color
          </a>
          <a onclick = "showColorPicker(1)">Primary Color</a>
          <a onclick = "showColorPicker(2)">Accent Color</a>
          <a onclick = "showColorPicker(3)">Text Color</a>
        </div>
      </div>

      <p class="greeting">
        hello, world!
      </p>

      <div class="dropdown" id="addCat">
        <button class="dropbtn">
          Add Category
          <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content" id="rightContent">
          <a onclick="genTextCard('test', 'this is a test')">Text</a>
          <a href="#">Todo</a>
          <a href="#">Bookmarks</a>
        </div>
      </div>
    </div>
    <h1></h1>
    
    <!--Testing putting the picker in a card that toggles with the background color button -->
    <div id = "bgColorCard" class = "card" hidden>
      <div class = "container">
        
        <h4>
          <button class="button" id="closeBtn" onclick = "hideColorPicker()">
                <i class="fa fa-times-circle fa-lg"></i>
              </button>
          <b id = "colorPickerTitle">Set Background Color</b>
          <p>
             <div id="picker"></div>
              <button class="button" id="setbgcolor">
                Set Color
              </button>
              <button class="button" id="reset">
                Reset
              </button>         
          </p>
        </h4>
      </div>
    </div>

    <div id="cards">
      <div class="card draggable">
      <div content-editable="true" class="container">
        <h4><b>Card Title</b></h4>
        <p>Card Text</p>
      </div>
    </div>
    <div class="card draggable">
      <div contenteditable="true" class="container">
        <h4><b>Card Title</b></h4>
        <p>Card Text</p>
      </div>
    </div>
  </div>
    <!--Drag and drop API: https://api.jqueryui.com/draggable/-->
    
  
  </body>

  <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    window.onload = () => {};
    
    var pickerType = 0; //variable stores what kind of color picker to display. 0=background 1=primary 2=accent 3=text

    var colorPicker = new iro.ColorPicker("#picker", {
      width: 150
    });

    var body = document.querySelector("body");
    var setbg = document.getElementById("setbgcolor");
    var reset = document.getElementById("reset");

    reset.onclick = function() {
    
      switch(pickerType){
          case 0:
            //background
            body.style.backgroundColor = "white";
            break;
          case 1:
            //primary
            var elem = document.getElementsByClassName("card draggable");          
            for (var i = 0; i < elem.length; i++){
              elem[i].style.backgroundColor = "white";
            }
            break;
          case 2:
            //accent
             var elem = document.getElementsByClassName("accentElement");          
            for (var i = 0; i < elem.length; i++){
              elem[i].style.backgroundColor = "white";
            }
            break;
          case 3:
            //text
            var elem = document.getElementsByClassName("card draggable");          
            for (var i = 0; i < elem.length; i++){
              elem[i].style.color = "white";
            }
            break;
        }  
    };

    colorPicker.on("color:change", function(color) {
      setbg.onclick = function() {
  
        switch(pickerType){
          case 0:
            //background
            body.style.backgroundColor = colorPicker.color.hexString;
            break;
          case 1:
            //primary
            var elem = document.getElementsByClassName("card draggable");          
            for (var i = 0; i < elem.length; i++){
              elem[i].style.backgroundColor = colorPicker.color.hexString;
            }
            break;
          case 2:
            //accent
            var elem = document.getElementsByClassName("accentElement");          
            for (var i = 0; i < elem.length; i++){
              elem[i].style.backgroundColor = colorPicker.color.hexString;
            }
            break;
          case 3:
            //text
            var elem = document.getElementsByClassName("card draggable");          
            for (var i = 0; i < elem.length; i++){
              elem[i].style.color = colorPicker.color.hexString;
            }
            break;
        }      
        
      };
    });

    $(function() {
       $(".draggable").draggable({zIndex: -1});
    });

    // Function should be implemented to log error in html
    //Function runs when error occurs like user not being logged in
    function logError(error) {
      console.warn(error); //place holder
    }

    // Function returns object of settings.
    // Empty if not logged in or settings dont exist
    function getSettings() {
      let settings = {};

      fetch("/settings")
        .then(res => res.json())
        .then(json => {
          if (!json.error) {
            settings = json;
          } else {
            logError(json.error);
          }
        });

      return settings;
    }

    //Function creates or updates settings also returns settings.
    // MUST include all params
    function createOrUpdateSettings(
      backgroundColor,
      primaryColor,
      accentColor,
      fontColor
    ) {
      let settings = {};

      fetch("/updatesettings", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          backgroundColor,
          primaryColor,
          accentColor,
          fontColor
        })
      })
        .then(res => res.json())
        .then(json => {
          if (!json.error) {
            settings = json;
          } else {
            logError(json.error);
          }
        });

      return settings;
    }

    // Function returns list of box objects.
    // Empty if not logged in or settings dont exist
    function getBoxes() {
      let boxes = [];

      fetch("/data")
        .then(res => res.json())
        .then(json => {
          if (!json.error) {
            boxes = json;
          } else {
            logError(json.error);
          }
        });

      return boxes;
    }

    // Function adds a box
    // title: is a string
    // PosX and PosY:  is a number
    // type: should be specific strings ('todo','text','link')
    // items: is a list/array of whatever you want
    // also returns boxes
    function addBox(title, posX, posY, type, items) {
      let boxes = [];

      fetch("/add", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          title,
          posX,
          posY,
          type,
          items
        })
      })
        .then(res => res.json())
        .then(json => {
          if (!json.error) {
            boxes = json;
          } else {
            logError(json.error);
          }
        });

      //add the element to the page

      return boxes;
    }

    // Function updates a box. use all params
    // Returns updated boxes
    function updateBox(_id, title, posX, posY, type, items) {
      let boxes = [];

      fetch("/update", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          _id,
          title,
          posX,
          posY,
          type,
          items
        })
      })
        .then(res => res.json())
        .then(json => {
          if (!json.error) {
            boxes = json;
          } else {
            logError(json.error);
          }
        });

      return boxes;
    }

    //Function deletes entire box
    // also returns boxes
    function deleteBox(_id) {
      let boxes = [];

      fetch("/remove", {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          _id
        })
      })
        .then(res => res.json())
        .then(json => {
          if (!json.error) {
            boxes = json;
          } else {
            logError(json.error);
          }
        });

      return boxes;
    }
    
    //generates a new text card
    function genTextCard(title, description){
      var cards = document.getElementById("cards");
      cards.innerHTML += `
        <div class="card draggable">
          <div class="container">
            <h4 contenteditable="true" ><b>${title}</b></h4>
            <p contenteditable="true" >${description}</p>
          </div>
        </div>
        `;
    }
    
    function genToDoCard(){
      // to be finished later
    }
    
    function genBookmarksCard(title, link){
      var cards = document.getElementById("cards");
      cards.innerHTML += `
        <div class="card draggable">
          <div class="container">
            <a href="${link}" ><b>${title}</b></h4>
          </div>
        </div>
        `;
    }
    
    //hide and show the color picker
    function showColorPicker(type){
      //set the type of the color picker
      pickerType = type;
      var elem = document.getElementById("bgColorCard");
      //also should change the name of the picker
      var title = document.getElementById("colorPickerTitle");
      switch(pickerType){
        case 0:
          //background
          title.innerHTML = "Set Background Color";
          break;
        case 1:
          //card
          title.innerHTML = "Set Primary Color";
          break;
        case 2:
          //accent elements
          title.innerHTML = "Set Accent Color";
          break;
        case 3:
          //text
          title.innerHTML = "Set Text Color";
          break;
      }
          
      elem.hidden = false;
    }
    
    function hideColorPicker(){
      var elem = document.getElementById("bgColorCard");
      elem.hidden = true;
    }
  </script>
</html>
