<!DOCTYPE html>
<html>

<head>
  <title>Enlighten Me</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/p5.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
  <link rel="stylesheet" href="/main.css">
</head>

<body>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Welcome to Enlighten Me</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p1>
            This is a web app based around the discussion of ideas and topics with others.
            A topic will appear on the image and everyone will be asked to guage their opinion on the topic.
            Everyone will then be able to chat with eachother about the topic and try to enlighten others to your opinion
            At the end of the chatting phase, everyone will be asked to guage your opinion on the topic again to see if anything has changed.
            <br> 
            <br>
            Enlighten away!
          </p1>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


  <nav class="navbar navbar-light bg-light">
    <a class="navbar-brand" href="/">
      <img src="https://cdn.glitch.com/aee5db39-84c5-480a-8f4a-12d8cb3976ea%2Fcard-checklist.svg?v=1600893665069"
        width="30" height="30" class="d-inline-block align-top" alt="" loading="lazy" />
      Enlighten Me
    </a>
    <div class="ml-auto">
      <div id="welcomeText" class="navbar-text align-self-end mr-2 font-weight-bold">
        Welcome, $namehere
      </div>
      <button id="logoutButton" type="button" class="btn btn-secondary">
        Logout
      </button>
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        Help
      </button>
    </div>
  </nav>

  <!----------Header---------->
  <div id="container" class="container-md">
    <div class="row">
      <div class="col d-flex flex-column align-items-center">
        <!----Image, Timer and start button column-->
        <div role="img" id="sketch-holder" class=></div>

        <h2 class="text-center bg-light rounded p-2" id="timerDisplay">Time Remaining - 5:00</h2>
        <h7 id = "timeBreakDown"></h7>
        <button class="startButton btn btn-success mt-2" onclick="sendStart()">START!</button>
        <div class="mt-4">

          <div id="voting" class="bg-light p-4 rounded">
            <p>Vote for the next category!</p>
            <form class="votingForm">
              <input type="radio" id="food" name="category" value="food">
              <label for="food">Food</label><br>
              <input type="radio" id="memes" name="category" value="memes">
              <label for="memes">Memes</label><br>
              <input type="radio" id="politics" name="category" value="politics">
              <label for="politics">Politics</label><br>
              <input type="radio" id="misc" name="category" value="misc">
              <label for="misc">Misc</label><br><br>
              <input id="send" class="btn btn-success mb-2" type="submit" value="Send">
            </form>
          </div>

          <div class="activeContentHolder">
            <div class="votingDiv">
              <div class="voteActionButtons">
                <h4 class="voteMessage mt-4"></h4>
                <div class="d-flex mt-3 justify-content-center">
                  <button class="btn btn-success" onclick="sendVote('A')">Agree</button>
                  <button class="btn btn-danger ml-3 mr-3" onclick="sendVote('D')">Disagree</button>
                  <button class="btn btn-secondary" onclick="sendVote('U')">No opinion/unsure</button>
                </div>
              </div>
              <h4 class="voteConfirmMessage">
                Thanks for your vote!
              </h4>
            </div>

            <div class="voteStatsContainer">
              <h4>Round is over! The next round will begin soon. Here are the stats from last round: </h4>
              <div class="mb-2">
                <h4 class="mb-0">Before: </h4><span class="voteStatsBefore">Agree: 0, Disagree: 0, Unsure: 0</span>
              </div>
              <div class="mb-2">
                <h4 class="mb-0">After: </h4><span class="voteStatsAfter mb-2">Agree: 0, Disagree: 0, Unsure: 0</span>
              </div>
            </div>
          </div>


        </div>
      </div>



      <div class="col">
        <!----Chat row--->

        <div class="messageBoxDiv">
          <div id="msgHolder" class="message_holder overflow-auto bg-light rounded" style="height: 745px;">
            <h3 id="noMessage" class="alert alert-info">No message yet..</h3>

          </div>

          <div class="textbox">
            <form action="" class="messageForm">
              <div class="d-flex mt-2 justify-content-between">
                <input type="text" id="messageBox" class="message form-control mr-2"
                  placeholder="Enlighten others here" />
                <input type="submit" class="btn btn-primary" />
              </div>
            </form>
          </div>
        </div>


      </div>
    </div>
    <!--image and prompt text-->



    <script src="/script.js"></script>



    <!-- &lt;!&ndash; jQuery (necessary for Bootstrap's JavaScript plugins) &ndash;&gt; -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <style>
      .alert-info .btn-success .btn-danger {
        float: right;
      }

      .alert-info span {
        line-height: 34px;
      }

      .alert-info>div:after {
        clear: both;
        content: '';
        display: table;
      }
    </style>
    <script type="text/javascript">
      function sendUpvote(msgNumber) {
        ws.send(JSON.stringify({
          event: "COMMENT_VOTE",
          msgNumber,
          id: CLIENT_ID,
          vote: "up"
        }))
      }
      function sendDownvote(msgNumber) {
        ws.send(JSON.stringify({
          event: "COMMENT_VOTE",
          msgNumber,
          id: CLIENT_ID,
          vote: "down"
        }))
      }
      function addMessage(msg) {

        $('h3').remove();
        $('div.message_holder').append('<div class ="box alert alert-info"><span><b class="text-primary">' + msg.user_name + ':' + '</b> ' + msg.message + '</span><span style="float: right"><p class="btn btn-success mr-2" onclick="sendUpvote(' + messageCount + ')">+1</p><p class="btn btn-danger mr-2" type="button" onclick="sendDownvote(' + messageCount + ')">-1</p><p class="badge badge-light" id="showscore' + messageCount + '">' + (msg.score === undefined ? 0 : msg.score) + '</p></span></div>')
        var scrollVal = document.getElementById("msgHolder").scrollHeight;
        $('div.message_holder').scrollTop(scrollVal);
        messageCount++;
        //$( 'div.message_holder' ).append( '<div class ="box"><b style="color: blue">' +loggedInUser+'</b> '+msg.message+'</div>' )
      }

      function newTopic() {
        $('div.box').remove()
        $('div.message_holder').append('<div class ="box"><b style="color: green">New Topic!</b> </div>')
        setTimeout(() => $('div.box').remove(), 3000)
      }

      function showChat(bool) {
        if (bool) {
          $('.messageBoxDiv').show()
        }
        else {
          $('.messageBoxDiv').hide()
        }
      }

      function showCategoryVote(bool) {
        if (bool) {
          $('#voting').show();
        }
        else {
          $('#voting').hide();
        }
      }

      function updateVoteStats(before, after) {
        $('.voteStatsBefore').text(`Agree: ${before.agree}, Disagree: ${before.disagree}, Unsure: ${before.unsure}`)
        $('.voteStatsAfter').text(`Agree: ${after.agree}, Disagree: ${after.disagree}, Unsure: ${after.unsure}`)
      }

      function showVoteStats(bool) {
        if (bool) {
          $('.voteStatsContainer').show()
        }
        else {
          $('.voteStatsContainer').hide()
        }
      }

      function showStartButton(bool) {
        if (bool) {
          $('.startButton').show()
        }
        else {
          $('.startButton').hide()
        }
      }

      function showVoteConfirmMessage(bool) {
        if (bool) {
          $('.voteConfirmMessage').show()
        }
        else {
          $('.voteConfirmMessage').hide()
        }
      }

      function showVoteActionButtons(bool) {
        if (bool) {
          $('.voteActionButtons').show()
        }
        else {
          $('.voteActionButtons').hide()
        }
      }

      function toggleVoting(voteType) {
        if (voteType === "INITIAL") {
          $('.votingDiv').show()
          $('.voteMessage').text("Before debating, how do you feel about the above statement?");
          showCategoryVote(false);
        }
        else if (voteType === "FINAL") {
          let elt = $('.votingDiv')
          $('.votingDiv').show()
          $('.voteMessage').text("After debating, how do you feel about the above statement?");
          showCategoryVote(true);
        }
        else {
          $('.votingDiv').hide();
          showCategoryVote(false);
        }
      }

      var form = $('.messageForm').on('submit', (e) => {
        e.preventDefault();
        //let user_name = $( 'input.username' ).val()
        let user_name = loggedInUser;
        let user_input = $('input.message').val()
        ws.send(JSON.stringify(
          {
            event: "CHAT_MESSAGE",
            user_name: user_name,
            message: user_input
          })
        )
        document.getElementById('messageBox').value = "";
      })
    </script>

  </div>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
</body>

</html>